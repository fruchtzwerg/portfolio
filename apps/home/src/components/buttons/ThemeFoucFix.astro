<!-- Calculate current theme first -->
<script is:inline>
  document.addEventListener('astro:after-swap', () => {
    try {
      const mediaDark = matchMedia('(prefers-color-scheme: dark)');
      const isDark =
        localStorage.theme === 'arcane' || (!('theme' in localStorage) && mediaDark.matches);

      localStorage.theme = document.documentElement.dataset.theme = isDark ? 'arcane' : 'winter';
    } catch (e) {
      // Do nothing
    }
  });
</script>
